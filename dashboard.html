<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Rushi // System Dash</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:"JetBrains Mono","Fira Code","Cascadia Code","SF Mono",Menlo,Consolas,"Lucida Console",monospace}
    body{
      height:100vh;width:100vw;overflow:hidden;
      display:flex;align-items:center;justify-content:center;
      background:radial-gradient(circle at top,#020617 0%,#020617 30%,#020617 60%,#000 100%);
      color:#e5e5e5;
    }
    .frame-wrapper{position:relative;width:94vw;max-width:1100px}
    .frame{
      position:relative;border-radius:22px;overflow:hidden;
      border:1px solid rgba(148,163,184,.35);
      background:radial-gradient(circle at top,#020617 0,#020617 55%,#020015 100%);
      box-shadow:0 0 40px rgba(0,0,0,.9),0 0 120px rgba(56,189,248,.25);
    }
    .frame::before{
      content:"";position:absolute;inset:0;pointer-events:none;
      background:
        radial-gradient(circle at top left,rgba(148,163,184,.2),transparent 55%),
        radial-gradient(circle at bottom right,rgba(56,189,248,.12),transparent 55%),
        repeating-linear-gradient(to bottom,rgba(15,23,42,.45),rgba(15,23,42,.45) 1px,transparent 1px,transparent 3px);
      mix-blend-mode:soft-light;opacity:.65;animation:scan 7s linear infinite;
    }
    @keyframes scan{0%{transform:translateY(-10px)}50%{transform:translateY(10px)}100%{transform:translateY(-10px)}}
    .frame-header{
      display:flex;align-items:center;gap:8px;padding:9px 14px;
      background:linear-gradient(90deg,#020617,#020617,#030712);
      border-bottom:1px solid rgba(148,163,184,.35);
      font-size:11px;text-transform:uppercase;letter-spacing:.12em;color:#9ca3af;
    }
    .dot{
      width:9px;height:9px;border-radius:999px;border:1px solid #020617;
      box-shadow:0 0 12px currentColor;animation:dotPulse 4s ease-in-out infinite;
    }
    .dot:nth-child(1){background:#f9fafb;color:#f9fafb}
    .dot:nth-child(2){background:#9ca3af;color:#9ca3af;opacity:.8;animation-delay:.3s}
    .dot:nth-child(3){background:#22d3ee;color:#22d3ee;opacity:.9;animation-delay:.6s}
    @keyframes dotPulse{0%,100%{transform:scale(1);box-shadow:0 0 6px currentColor}50%{transform:scale(1.25);box-shadow:0 0 14px currentColor}}
    .title{margin-left:6px;color:#e5e5e5}
    .frame-body{
      padding:16px 18px 18px;font-size:12px;
      display:grid;grid-template-columns:1.3fr 1fr 1.1fr;gap:14px;
    }
    .block{
      border-radius:14px;padding:10px 11px 9px;position:relative;overflow:hidden;
      background:radial-gradient(circle at top left,rgba(15,23,42,.95),rgba(15,23,42,.9));
      border:1px solid rgba(55,65,81,.9);box-shadow:0 0 18px rgba(15,23,42,.9);
    }
    .block::after{
      content:"";position:absolute;inset:0;border-radius:14px;
      border:1px solid rgba(148,163,184,.06);pointer-events:none;
    }
    .block-main{
      border-color:rgba(148,163,184,.9);
      box-shadow:0 0 28px rgba(148,163,184,.4),0 0 60px rgba(56,189,248,.25);
      background:
        radial-gradient(circle at top left,rgba(248,250,252,.12),transparent 55%),
        radial-gradient(circle at bottom right,rgba(56,189,248,.16),transparent 60%),
        #020617;
    }
    .block-world,.block-weather,.block-day,.block-timers{
      border-color:rgba(107,114,128,.9);
      background:radial-gradient(circle at top,rgba(148,163,184,.16),transparent 55%),#020617;
    }
    .block-header{
      font-size:10px;text-transform:uppercase;letter-spacing:.18em;
      color:#e5e7eb;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;opacity:.95;
    }
    .block-header span:first-child{color:#d1d5db}
    .mono-label{font-size:9px;color:#6b7280}
    .primary-line{
      font-size:26px;color:#f9fafb;text-transform:uppercase;letter-spacing:.12em;
      margin-bottom:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .secondary-line{font-size:13px;color:#d1d5db;opacity:.9;margin-bottom:6px}
    .time-line{font-size:22px;color:#e5e7eb;letter-spacing:.08em;display:flex;align-items:center;gap:6px}
    .cursor{width:9px;height:15px;background:#22d3ee;display:inline-block;animation:blink 1s steps(2,start) infinite;box-shadow:0 0 10px rgba(34,211,238,.8)}
    @keyframes blink{0%,50%{opacity:1}50.01%,100%{opacity:0}}
    .status-line{font-size:11px;margin-top:4px;color:#e5e7eb;opacity:.9}
    .status-line span{color:#22d3ee}
    .secret-income{margin-top:8px;font-size:11px;color:#9ca3af;filter:blur(7px);transition:filter .2s ease;cursor:pointer}
    .secret-income:hover{filter:blur(0)}
    ul{list-style:none;margin-top:3px}
    li{margin-bottom:3px;font-size:11.5px;color:#f9fafb;display:flex;gap:6px;align-items:baseline}
    li::before{content:">";color:#6b7280;opacity:.9;font-size:10px;margin-top:1px}
    .world-row{display:flex;flex-direction:column;gap:6px;margin-top:4px}
    .world-line{display:flex;justify-content:space-between;font-size:11.5px}
    .world-label{text-transform:uppercase;letter-spacing:.12em;font-size:9px;color:#9ca3af}
    .world-city{color:#e5e5e5}
    .world-time{letter-spacing:.06em;color:#f9fafb}
    .world-offset{font-size:10px;color:#6b7280}
    .weather-row{display:flex;flex-direction:column;gap:6px;margin-top:4px}
    .weather-line{display:flex;justify-content:space-between;align-items:baseline;font-size:11.5px}
    .weather-city{display:flex;flex-direction:column;gap:1px}
    .weather-temp{font-size:16px;font-weight:600;color:#f9fafb;text-shadow:0 0 12px rgba(148,163,184,.7)}
    .weather-meta{font-size:10px;color:#9ca3af}
    .weather-status{font-size:10px;color:#6b7280;margin-top:4px}
    .timer-row{margin-top:4px;margin-bottom:6px}
    .timer-label{
      font-size:10px;text-transform:uppercase;letter-spacing:.16em;
      color:#e5e7eb;margin-bottom:2px;display:flex;justify-content:space-between;align-items:center;
    }
    .timer-main{display:flex;justify-content:space-between;align-items:baseline;gap:10px;font-size:11px}
    .timer-name{color:#f9fafb}
    .timer-countdown{font-size:11px;color:#f9fafb;letter-spacing:.05em;white-space:nowrap;text-shadow:0 0 10px rgba(248,250,252,.55)}
    .progress-track{
      margin-top:3px;width:100%;height:5px;
      background:rgba(15,23,42,.9);border-radius:999px;overflow:hidden;border:1px solid rgba(55,65,81,.9);
    }
    .progress-fill{height:100%;width:0%;transform-origin:left;transition:width .8s ease-out}
    .progress-fill.permit{
      background:linear-gradient(90deg,#22d3ee 0%,#38bdf8 100%);
      box-shadow:0 0 10px rgba(56,189,248,.7);animation:shimmer 2.2s linear infinite;
    }
    .progress-fill.age{
      background:linear-gradient(90deg,#e5e7eb 0%,#f9fafb 100%);
      box-shadow:0 0 10px rgba(249,250,251,.7);animation:shimmer 3s linear infinite;
    }
    @keyframes shimmer{0%{filter:brightness(.9)}50%{filter:brightness(1.3)}100%{filter:brightness(.9)}}
    .timer-meta{font-size:10px;color:#e5e7eb;margin-top:2px}
    .timer-meta span{color:#22d3ee}
    .spinner{
      width:18px;height:18px;border-radius:999px;border:2px solid rgba(15,23,42,.9);
      border-top-color:#22d3ee;border-right-color:#f9fafb;animation:spin 1.6s linear infinite;
      box-shadow:0 0 12px rgba(34,211,238,.7);
    }
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .finite-line{font-size:10px;color:#e5e7eb;margin-top:4px}
    .finite-line span{color:#f9fafb;font-weight:500}
    .event-columns{display:flex;gap:10px;margin-top:4px}
    .event-column{flex:1;min-width:0}
    .section-title{font-size:9px;text-transform:uppercase;letter-spacing:.16em;color:#6b7280;margin-bottom:2px}
    .event-list{list-style:none;margin-top:2px;max-height:150px;overflow-y:auto;padding-right:2px}
    .event-item{margin-bottom:5px;padding-bottom:4px;border-bottom:1px solid rgba(55,65,81,.7);font-size:11px}
    .event-empty{font-size:10px;color:#4b5563;font-style:italic;border-bottom:none}
    .event-time{color:#9ca3af;font-size:10px;text-transform:uppercase;letter-spacing:.12em}
    .event-title{color:#f9fafb;font-size:11px}
    .event-meta{color:#6b7280;font-size:10px;margin-top:1px}
    .schedule-status{margin-top:6px;font-size:10px;color:#6b7280}
    .block-main{grid-column:1 / span 2;grid-row:1 / span 1}
    .block-world{grid-column:3 / span 1;grid-row:1 / span 1}
    .block-weather{grid-column:3 / span 1;grid-row:2 / span 1}
    .block-day{grid-column:1 / span 2;grid-row:2 / span 1}
    .block-timers{grid-column:1 / span 3;grid-row:3 / span 1}
    @media(max-width:900px){
      .frame-body{grid-template-columns:1fr 1fr}
      .block-main{grid-column:1 / span 2}
      .block-world{grid-column:1 / span 1}
      .block-weather{grid-column:2 / span 1}
      .block-day{grid-column:1 / span 2}
      .block-timers{grid-column:1 / span 2}
    }
    @media(max-width:720px){
      .frame-body{grid-template-columns:1fr}
      .block-main,.block-world,.block-weather,.block-day,.block-timers{grid-column:1 / span 1}
    }
  </style>
</head>
<body>
  <div class="frame-wrapper">
    <div class="frame">
      <div class="frame-header">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <span class="title">vivasvan@system:~$ dash --live --finite</span>
      </div>
      <div class="frame-body">
        <div class="block block-main">
          <div class="block-header">
            <span>// NOW</span><span class="mono-label">local time</span>
          </div>
          <div id="day" class="primary-line"></div>
          <div id="date" class="secondary-line"></div>
          <div class="time-line"><span id="time"></span><span class="cursor"></span></div>
          <div class="status-line"><span>+1% today</span> is enough.</div>
          <div class="secret-income">income: <span id="income-amount">CAD 0 / month</span></div>
        </div>

        <div class="block block-world">
          <div class="block-header">
            <span>// TIME ZONES</span><span class="mono-label">hamilton • ahmedabad</span>
          </div>
          <div class="world-row">
            <div class="world-line">
              <div class="world-city">
                <span class="world-label">ca / ontario</span>
                <span class="world-city">Hamilton</span>
              </div>
              <div style="text-align:right">
                <div id="time-hamilton" class="world-time"></div>
                <div class="world-offset">America/Toronto</div>
              </div>
            </div>
            <div class="world-line">
              <div class="world-city">
                <span class="world-label">in / gujarat</span>
                <span class="world-city">Ahmedabad</span>
              </div>
              <div style="text-align:right">
                <div id="time-ahmedabad" class="world-time"></div>
                <div class="world-offset">Asia/Kolkata</div>
              </div>
            </div>
          </div>
        </div>

        <div class="block block-weather">
          <div class="block-header">
            <span>// CONDITIONS</span><span class="mono-label">temperature snapshot</span>
          </div>
          <div class="weather-row">
            <div class="weather-line">
              <div class="weather-city">
                <span class="world-label">hamilton</span>
                <span id="wx-ham-desc" class="weather-meta">loading…</span>
              </div>
              <div><span id="wx-ham-temp" class="weather-temp">--°C</span></div>
            </div>
            <div class="weather-line">
              <div class="weather-city">
                <span class="world-label">ahmedabad</span>
                <span id="wx-ahm-desc" class="weather-meta">loading…</span>
              </div>
              <div><span id="wx-ahm-temp" class="weather-temp">--°C</span></div>
            </div>
          </div>
          <div id="wx-status" class="weather-status">pinging weather service…</div>
        </div>

        <div class="block block-day">
          <div class="block-header">
            <span>// TODAY</span><span class="mono-label">events • tasks</span>
          </div>
          <div class="event-columns">
            <div class="event-column">
              <div class="section-title">events</div>
              <ul id="events-list" class="event-list">
                <li class="event-item event-empty">loading…</li>
              </ul>
            </div>
            <div class="event-column">
              <div class="section-title">tasks</div>
              <ul id="tasks-list" class="event-list">
                <li class="event-item event-empty">loading…</li>
              </ul>
            </div>
          </div>
          <div id="schedule-status" class="schedule-status">calendar: waiting for data…</div>
        </div>

        <div class="block block-timers">
          <div class="block-header">
            <span>// TIMELINES</span><span class="mono-label">finite window</span>
          </div>
          <div class="timer-row">
            <div class="timer-label">
              <span>work permit</span><span class="mono-label">to: 01 oct 2028</span>
            </div>
            <div class="timer-main">
              <div class="timer-name">T-minus (permit):</div>
              <div id="countdown-permit" class="timer-countdown">--y --d --:--:--</div>
            </div>
            <div class="progress-track"><div id="bar-permit" class="progress-fill permit"></div></div>
            <div class="timer-meta">
              used: <span id="permit-used">--%</span> • remaining days: <span id="permit-days">--</span>
            </div>
          </div>
          <div class="timer-row">
            <div class="timer-label">
              <span>age 0 → 30</span><span class="mono-label">to: 22 nov 2033</span>
            </div>
            <div class="timer-main">
              <div class="timer-name">T-minus (30):</div>
              <div id="countdown-30" class="timer-countdown">--y --d --:--:--</div>
            </div>
            <div class="progress-track"><div id="bar-30" class="progress-fill age"></div></div>
            <div class="timer-meta">
              lived: <span id="life-used">--%</span> • days lived: <span id="days-lived">--</span> • days to 30: <span id="days-to-30">--</span>
            </div>
          </div>
          <div style="margin-top:6px;display:flex;align-items:center;gap:8px">
            <div class="spinner"></div>
            <div class="finite-line">[finite] <span>one-way time.</span> make him proud.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const CURRENT_MONTHLY_INCOME = 3200; // change this
    const ICAL_URL = "/api/calendar"; // Vercel proxy route

    function updateLocalDateTime(){
      const now=new Date();
      const dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
      const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
      const day=dayNames[now.getDay()];
      const dateStr=`${monthNames[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
      let hours=now.getHours();
      const minutes=String(now.getMinutes()).padStart(2,"0");
      const ampm=hours>=12?"PM":"AM";
      hours=hours%12;if(hours===0)hours=12;
      const timeStr=`${hours}:${minutes} ${ampm}`;
      document.getElementById("day").textContent=day;
      document.getElementById("date").textContent=dateStr;
      document.getElementById("time").textContent=timeStr;
    }

    function formatTimeInZone(tz){
      const now=new Date();
      const opt={hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:true,timeZone:tz};
      return new Intl.DateTimeFormat("en-CA",opt).format(now);
    }
    function updateWorldClocks(){
      document.getElementById("time-hamilton").textContent=formatTimeInZone("America/Toronto");
      document.getElementById("time-ahmedabad").textContent=formatTimeInZone("Asia/Kolkata");
    }

    async function fetchWeather(){
      const statusEl=document.getElementById("wx-status");
      const hamTempEl=document.getElementById("wx-ham-temp");
      const ahmTempEl=document.getElementById("wx-ahm-temp");
      const hamDescEl=document.getElementById("wx-ham-desc");
      const ahmDescEl=document.getElementById("wx-ahm-desc");
      try{
        statusEl.textContent="updating weather…";
        const hamRes=await fetch("https://api.open-meteo.com/v1/forecast?latitude=43.255&longitude=-79.871&current_weather=true");
        const hamData=await hamRes.json();
        const ahmRes=await fetch("https://api.open-meteo.com/v1/forecast?latitude=23.0225&longitude=72.5714&current_weather=true");
        const ahmData=await ahmRes.json();
        if(hamData.current_weather){
          hamTempEl.textContent=Math.round(hamData.current_weather.temperature)+"°C";
          hamDescEl.textContent="wind "+hamData.current_weather.windspeed+" km/h";
        }else hamDescEl.textContent="no data";
        if(ahmData.current_weather){
          ahmTempEl.textContent=Math.round(ahmData.current_weather.temperature)+"°C";
          ahmDescEl.textContent="wind "+ahmData.current_weather.windspeed+" km/h";
        }else ahmDescEl.textContent="no data";
        statusEl.textContent="weather: ok • source: open-meteo.com";
      }catch(e){
        statusEl.textContent="weather: failed (offline or blocked).";
        hamDescEl.textContent="check connection";
        ahmDescEl.textContent="check connection";
      }
    }

    const permitStart=new Date("2025-10-01T00:00:00");
    const permitEnd=new Date("2028-10-01T00:00:00");
    const birthDate=new Date("2003-11-22T00:00:00");
    const age30Date=new Date("2033-11-22T00:00:00");

    function formatCountdown(target){
      const now=new Date();let diff=target-now;if(diff<0)diff=0;
      let totalSeconds=Math.floor(diff/1000);
      const seconds=totalSeconds%60;totalSeconds=(totalSeconds-seconds)/60;
      const minutes=totalSeconds%60;totalSeconds=(totalSeconds-minutes)/60;
      const hours=totalSeconds%24;const days=(totalSeconds-hours)/24;
      const years=Math.floor(days/365);const remainingDays=days%365;
      return{years,days:remainingDays,hours,minutes,seconds,rawDays:days+years*365};
    }
    function clampPercent(v){if(isNaN(v))return 0;if(v<0)return 0;if(v>100)return 100;return v;}

    function updateTimelines(){
      const now=new Date();
      const totalPermit=permitEnd-permitStart;
      let elapsedPermit=now-permitStart;
      if(elapsedPermit<0)elapsedPermit=0;
      if(elapsedPermit>totalPermit)elapsedPermit=totalPermit;
      const permitPercent=clampPercent(elapsedPermit/totalPermit*100);
      const permitRemain=formatCountdown(permitEnd);
      document.getElementById("countdown-permit").textContent=
        `${permitRemain.years}y ${permitRemain.days}d `+
        `${String(permitRemain.hours).padStart(2,"0")}:`+
        `${String(permitRemain.minutes).padStart(2,"0")}:`+
        `${String(permitRemain.seconds).padStart(2,"0")}`;
      document.getElementById("bar-permit").style.width=permitPercent+"%";
      document.getElementById("permit-used").textContent=permitPercent.toFixed(1)+"%";
      const daysToPermit=Math.floor((permitEnd-now)/(1000*60*60*24));
      document.getElementById("permit-days").textContent=daysToPermit>=0?daysToPermit:0;

      const totalLifeTo30=age30Date-birthDate;
      let livedToNow=now-birthDate;
      if(livedToNow<0)livedToNow=0;
      if(livedToNow>totalLifeTo30)livedToNow=totalLifeTo30;
      const lifePercent=clampPercent(livedToNow/totalLifeTo30*100);
      const ageCountdown=formatCountdown(age30Date);
      document.getElementById("countdown-30").textContent=
        `${ageCountdown.years}y ${ageCountdown.days}d `+
        `${String(ageCountdown.hours).padStart(2,"0")}:`+
        `${String(ageCountdown.minutes).padStart(2,"0")}:`+
        `${String(ageCountdown.seconds).padStart(2,"0")}`;
      document.getElementById("bar-30").style.width=lifePercent+"%";
      document.getElementById("life-used").textContent=lifePercent.toFixed(1)+"%";
      const daysLived=Math.floor((now-birthDate)/(1000*60*60*24));
      const daysTo30=Math.floor((age30Date-now)/(1000*60*60*24));
      document.getElementById("days-lived").textContent=daysLived>=0?daysLived:0;
      document.getElementById("days-to-30").textContent=daysTo30>=0?daysTo30:0;
    }

    function parseICal(icsText){
      const lines=icsText.split(/\r?\n/);
      const events=[];let current=null;
      for(const raw of lines){
        const line=raw.trim();
        if(line==="BEGIN:VEVENT"){current={};continue;}
        if(line==="END:VEVENT"){if(current)events.push(current);current=null;continue;}
        if(!current)continue;
        const idx=line.indexOf(":");if(idx===-1)continue;
        const keyPart=line.slice(0,idx);const value=line.slice(idx+1);
        const key=keyPart.split(";")[0].toUpperCase();
        if(key==="SUMMARY")current.summary=value;
        else if(key==="DESCRIPTION")current.description=value;
        else if(key==="LOCATION")current.location=value;
        else if(key==="DTSTART"||key==="DTSTART;TZID"){current.dtstart=value;}
      }
      return events;
    }
    function normalizeICalDate(str){
      if(!str)return null;
      const clean=str.replace(/^.*:/,"");
      if(clean.length===8){
        const y=clean.slice(0,4);const m=clean.slice(4,6);const d=clean.slice(6,8);
        return new Date(`${y}-${m}-${d}T00:00:00`);
      }
      if(clean.length>=15){
        const y=clean.slice(0,4);const m=clean.slice(4,6);const d=clean.slice(6,8);
        const hh=clean.slice(9,11);const mm=clean.slice(11,13);
        return new Date(`${y}-${m}-${d}T${hh}:${mm}:00`);
      }
      return new Date(clean);
    }
    function isSameDay(a,b){
      return a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate();
    }
    function formatTimeHM(date){
      let h=date.getHours();const m=String(date.getMinutes()).padStart(2,"0");
      const ampm=h>=12?"PM":"AM";h=h%12;if(h===0)h=12;
      return `${h}:${m} ${ampm}`;
    }

    async function refreshSchedule(){
      const status=document.getElementById("schedule-status");
      const eventsList=document.getElementById("events-list");
      const tasksList=document.getElementById("tasks-list");
      eventsList.innerHTML='<li class="event-item event-empty">loading…</li>';
      tasksList.innerHTML='<li class="event-item event-empty">loading…</li>';
      try{
        status.textContent="calendar: fetching from proxy…";
        const res=await fetch(ICAL_URL);
        if(!res.ok){status.textContent="calendar: failed to load (bad response).";return;}
        const text=await res.text();
        const events=parseICal(text);
        const today=new Date();
        const todays=events.filter(ev=>{
          const d=normalizeICalDate(ev.dtstart);if(!d)return false;
          return isSameDay(d,today);
        }).sort((a,b)=>normalizeICalDate(a.dtstart)-normalizeICalDate(b.dtstart));
        const realEvents=[];const tasks=[];
        for(const ev of todays){
          const title=ev.summary||"(no title)";
          const isTask=/\[TASK\]/i.test(title);
          const cleanTitle=title.replace(/\[TASK\]/ig,"").trim()||"(task)";
          const dateObj=normalizeICalDate(ev.dtstart);
          const timeStr=dateObj?formatTimeHM(dateObj):"all day";
          const metaParts=[];
          if(ev.location)metaParts.push(ev.location);
          if(ev.description)metaParts.push(ev.description.replace(/\\n/g," "));
          const meta=metaParts.join(" • ");
          const item={time:timeStr,title:cleanTitle,meta};
          if(isTask)tasks.push(item);else realEvents.push(item);
        }
        function renderList(listEl,items,emptyText){
          if(!items.length){
            listEl.innerHTML=`<li class="event-item event-empty">${emptyText}</li>`;return;
          }
          listEl.innerHTML="";
          for(const item of items){
            const li=document.createElement("li");
            li.className="event-item";
            li.innerHTML=
              `<div class="event-time">${item.time}</div>`+
              `<div class="event-title">${item.title}</div>`+
              (item.meta?`<div class="event-meta">${item.meta}</div>`:"");
            listEl.appendChild(li);
          }
        }
        renderList(eventsList,realEvents,"no events today");
        renderList(tasksList,tasks,"no tasks tagged [TASK]");
        status.textContent=`calendar: today → ${realEvents.length} events • ${tasks.length} tasks`;
      }catch(e){
        status.textContent="calendar: failed to load (CORS, bad URL, or offline).";
      }
    }

    function initIncome(){
      const el=document.getElementById("income-amount");
      el.textContent=`CAD ${CURRENT_MONTHLY_INCOME.toLocaleString("en-CA")}/month`;
    }

    updateLocalDateTime();
    updateWorldClocks();
    fetchWeather();
    updateTimelines();
    initIncome();
    refreshSchedule();
    setInterval(updateLocalDateTime,1000);
    setInterval(updateWorldClocks,1000);
    setInterval(fetchWeather,15*60*1000);
    setInterval(updateTimelines,1000);
    setInterval(refreshSchedule,10*60*1000);

    // Auto-reload the whole page every 5 minutes
window.addEventListener("load", () => {
  const FIVE_MIN = 5 * 60 * 1000;
  setInterval(() => {
    window.location.reload();
  }, FIVE_MIN);
});
  </script>
</body>
</html>
